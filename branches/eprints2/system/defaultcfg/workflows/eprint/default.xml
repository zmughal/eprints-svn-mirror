<?xml version="1.0" encoding="utf-8"?>
<workflow xmlns="http://eprints.org/ep2/workflow" xmlns:ep="http://eprints.org/ep2/">
  <flow>
    <stage ref="type"/>
    <stage ref="files"/>
    <stage ref="core"/>
    <stage ref="pubinfo"/>
    <ep:ifmatch name="type" merge="ANY" value="conference_item">
      <stage ref="event"/>
    </ep:ifmatch>
    <stage ref="subjects"/>
  </flow>


  <stage name="type">
    <component><field ref="type"><required/></field></component>
  </stage>

  <stage name="files">
    <component type="UploadComponent"></component>
  </stage>


  <stage name="core">

    <component><field ref="title"><required/></field></component>

    <ep:ifmatch name="type" merge="ANY" value="monograph">
      <component><field ref="monograph_type"><required/></field></component>
    </ep:ifmatch>

    <ep:ifmatch name="type" merge="ANY" value="thesis">
      <component><field ref="thesis_type"><required/></field></component>
    </ep:ifmatch>

    <ep:ifmatch name="type" merge="ANY" value="conference_item">
      <component><field ref="pres_type"><required/></field></component>
    </ep:ifmatch>

    <ep:ifmatch name="type" merge="ANY" value="book book_section">
      <component><field ref="creators_list"/></component>
      <component><field ref="editors_list"/></component>
    </ep:ifmatch>
    <ep:ifnotmatch name="type" merge="ANY" value="book book_section">
      <component><field ref="creators_list"><required/></field></component>
    </ep:ifnotmatch>

    <ep:ifmatch name="type" merge="ANY" value="book_section book article conference_item">
      <component><field ref="refereed"><required/></field></component>
    </ep:ifmatch>
    <ep:ifnotmatch name="type" merge="ANY" value="patent">
      <component><field ref="ispublished"><required/></field></component>
    </ep:ifnotmatch>

    <component><field ref="abstract"/></component>
    <component><field ref="referencetext"/></component>
    <component><field ref="keywords"/></component>

  </stage>

  <stage name="pubinfo">
    <ep:ifmatch name="type" merge="ANY" value="patent">
      <component><field ref="date_issue"><required/></field></component>
      <component><field ref="official_url"/></component>
      <component><field ref="patent_applicant"><required/></field></component>
      <component><field ref="id_number"><required/></field></component>
      <component><field ref="pages"/></component>
    </ep:ifmatch>
    <ep:ifmatch name="type" merge="ANY" value="monograph">
      <component><field ref="institution"/></component>
      <component><field ref="department"/></component>
      <component><field ref="place_of_pub"/></component>
      <component><field ref="publisher"><required/></field></component>
      <component><field ref="id_number"/></component>
      <component><field ref="pages"/></component>
      <component><field ref="date_issue"/></component>
      <component><field ref="date_sub"/></component>
      <component><field ref="official_url"/></component>
    </ep:ifmatch>
    <ep:ifmatch name="type" merge="ANY" value="book">
      <component><field ref="date_issue"/></component>
      <component><field ref="date_sub"/></component>
      <component><field ref="place_of_pub"/></component>
      <component><field ref="publisher"><required/></field></component>
      <component><field ref="pages"/></component>
      <component><field ref="series"/></component>
      <component><field ref="volume"/></component>
      <component><field ref="number"/></component>
      <component><field ref="isbn"/></component>
      <component><field ref="official_url"/></component>
    </ep:ifmatch>
    <ep:ifmatch name="type" merge="ANY" value="other">
      <component><field ref="date_issue"/></component>
      <component><field ref="date_sub"/></component>
      <component><field ref="official_url"/></component>
      <component><field ref="place_of_pub"/></component>
      <component><field ref="publisher"><required/></field></component>
      <component><field ref="id_number"/></component>
    </ep:ifmatch>
    <ep:ifmatch name="type" merge="ANY" value="book_section">
      <component><field ref="pagerange"/></component>
      <component><field ref="book_title"><required/></field></component>
      <component><field ref="volume"/></component>
      <component><field ref="place_of_pub"/></component>
      <component><field ref="publisher"><required/></field></component>
      <component><field ref="pages"/></component>
      <component><field ref="id_number"/></component>
      <component><field ref="series"/></component>
      <component><field ref="number"/></component>
      <component><field ref="isbn"/></component>
      <component><field ref="date_issue"/></component>
      <component><field ref="date_sub"/></component>
      <component><field ref="official_url"/></component>
    </ep:ifmatch>
    <ep:ifmatch name="type" merge="ANY" value="thesis">
      <component><field ref="date_issue"><required/></field></component>
      <component><field ref="official_url"/></component>
      <component><field ref="institution"><required/></field></component>
      <component><field ref="department"><required/></field></component>
      <component><field ref="pages"/></component>
    </ep:ifmatch>
    <ep:ifmatch name="type" merge="ANY" value="conference_item">
      <component><field ref="date_issue"/></component>
      <component><field ref="date_sub"/></component>
      <component><field ref="pages"/></component>
      <component><field ref="official_url"/></component>
    </ep:ifmatch>
    <ep:ifmatch name="type" merge="ANY" value="article">
      <component><field ref="publication"><required/></field></component>
      <component><field ref="volume"/></component>
      <component><field ref="number"/></component>
      <component><field ref="pagerange"/></component>
      <component><field ref="date_issue"/></component>
      <component><field ref="date_sub"/></component>
      <component><field ref="id_number"/></component>
      <component><field ref="official_url"/></component>
      <component><field ref="issn"/></component>
    </ep:ifmatch>

  </stage>

  <stage name="subjects">
    <component type="FieldComponent::SubjectComponent"><field ref="subjects"><required/></field></component>
    <component><field ref="note"/></component>
    <component><field ref="suggestions"/></component>
  </stage>

  <stage name="event">
    <component><field ref="event_title"><required/></field></component>
    <component><field ref="event_type"><required/></field></component>
    <component><field ref="event_location"/></component>
    <component><field ref="event_dates"/></component>
  </stage>
</workflow>
