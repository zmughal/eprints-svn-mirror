#!/usr/bin/perl -w

######################################################################
#
# cjg
#
######################################################################
#
#  __COPYRIGHT__
#
# Copyright 2000-2008 University of Southampton. All Rights Reserved.
# 
#  __LICENSE__
#
######################################################################

use EPrints::Session;
use EPrints::HTMLRender;
use EPrints::ImportXML;
use EPrints::EPrint;
use strict;
if( scalar @ARGV != 2 )
{
	print STDERR "import_xml <siteid> <xmlfilename>\n";
	exit( 1 );
}

my $session = new EPrints::Session( 1 , $ARGV[0] );
exit( 1 ) unless( defined $session );


EPrints::ImportXML::import_file( $session , $ARGV[1] , \&deal );

$session->terminate();

exit;

sub deal 
{
	my( $session , $table , $eprint ) = @_;
	print EPrints::Session::render_struct( $eprint );


	#print $session->{render}->render_eprint_citation( $eprint, 0, 0)."\n";
	print "------------\n";
	my $ds = $session->get_archive()->get_data_set( "archive" );
	if( $session->get_db()->exists( $ds , $eprint->get_value( "eprintid" ) ) )
	{
		print  "EXISTS!\n";
		$eprint->commit;
		return;
	}
	print  "NOT EXISTS!\n";
	EPrints::EPrint::create( $session, $ds, undef, $eprint->get_data() );
}

