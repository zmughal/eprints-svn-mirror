ONLINEHELPFILES = online-help/latex/online-help.tex online-help/latex/access.tex online-help/latex/deposit.tex online-help/latex/register.tex online-help/latex/subscribe.tex online-help/latex/userarea.tex
SYSTEMDOCFILES = system/latex/system.tex system/latex/system-body.tex system/latex/images/components.eps system/latex/images/components.jpg system/latex/images/components.fig

all: eprints-install.pdf eprints-install.html eprints-install-headless.html online-help.pdf online-help-final eprints-system.pdf

eprints-install.pdf: installation/latex/eprints-install.tex installation/latex/eprints-install-body.tex
	cd installation/latex ; pdflatex eprints-install ; pdflatex eprints-install
	mv installation/latex/eprints-install.pdf .

eprints-install.html: installation/latex/eprints-install.tex installation/latex/eprints-install-body.tex
	cd installation/latex ; latex eprints-install ; latex eprints-install ; latex2html -split 0 -no_navigation -info 0 -white -no_reuse -show_section_numbers eprints-install
	mv installation/latex/eprints-install/eprints-install.html .
	mv installation/latex/eprints-install/eprints-install.css .
	rm -rf installation/latex/eprints-install

eprints-install-headless.html: eprints-install.html
	./remove_html_head.pl <eprints-install.html >eprints-install-headless.html

online-help.pdf:  $(ONLINEHELPFILES)
	cd online-help/latex ; pdflatex online-help ; pdflatex online-help
	mv online-help/latex/online-help.pdf .

online-help-final: $(ONLINEHELPFILES)
	rm -rf online-help-final online-help-html
	cd online-help/latex ; latex online-help ; latex online-help ; latex2html -split 4 -no_navigation -info 0 -white -no_reuse online-help
	mv online-help/latex/online-help online-help-html
	sleep 30s # For NFS to catch up...
	./generate_help_html.pl
	rm -rf online-help-html

install-online-help: online-help.pdf online-help-final
	cp online-help.pdf ../system/static/help/
	cp online-help-final/*.jpg ../system/static/help
	cp online-help-final/*.html ../system/static/help

install: install-online-help install-web

install-web:
	./preparebody.pl 'TITLE: eprints.org Archive Software Installation Document' '<BR><BR>' < eprints-install-headless.html > ../website/in-html/eprints-install.html
	cp eprints-system.pdf ../website/in-raw
	cp eprints-install.pdf ../website/in-raw
	
eprints-system.pdf: $(SYSTEMDOCFILES)
	cd system/latex ; pdflatex system ; pdflatex system
	mv system/latex/system.pdf eprints-system.pdf

eprints-system.dvi: $(SYSTEMDOCFILES)
	cd system/latex ; latex system ; latex system


clean:
	rm -rf eprints-install.pdf eprints-install.html eprints-install.css eprints-install-headless.html *.log installation/latex/*.aux installation/latex/*.dvi installation/latex/*.log installation/latex/*.ps
	rm -rf online-help.pdf *.log online-help/latex/*.aux online-help/latex/*.dvi online-help/latex/*.log online-help/latex/*.ps online-help-final online-help-html
	rm -rf eprints-system.pdf system/latex/*.aux system/latex/*.dvi system/latex/*.log system/latex/*.ps
