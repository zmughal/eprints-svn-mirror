use EPrints::Session;
use EPrints::EPrint;

use strict;
my $session = new EPrints::Session;
Apache::exit( 0 ) unless( defined $session );

if( !$session->get_repository->get_conf( "json","enable" ) )
{
	EPrints::Apache::AnApache::send_status_line( $session->get_request, 403, "Not allowed" );
	EPrints::Apache::AnApache::send_http_header( $session->get_request );

	$session->terminate;
	exit;
}

my $callback = $session->param( "callback" ) || "callback";
my $eprintid = $session->param( "eprintid" );
my $eprint = EPrints::DataObj::EPrint->new( 
			$session, 
			$eprintid, 
			$session->get_repository->get_dataset( "archive" ) );
$session->send_http_header( "content_type"=>"text/javascript" );
print $callback."(\n";
if( defined $eprint )
{
	print $eprint->export( "JSON" );
}
else
{
	print "null";
}
print ");\n";

$session->terminate;

