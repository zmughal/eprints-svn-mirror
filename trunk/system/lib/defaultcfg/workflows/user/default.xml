<?xml version="1.0" encoding="utf-8"?>

<workflow xmlns="http://eprints.org/ep3/workflow" xmlns:epc="http://eprints.org/ep3/control">

  <flow>
    <stage ref="default"/>
    <stage ref="oo"/>
  </flow>
   
  <stage name="oo">
      <component><field ref="usertype"/></component>
  </stage>

  <stage name="default">
    <component><field ref="password"/></component>
    <epc:if test="$STAFF_ONLY">
      <component><field ref="usertype"/></component>
      <component><field ref="username"/></component>
      <component><field ref="email"/></component>
    </epc:if>
    <component><field ref="hideemail"/></component>
    <component><field ref="name"><required/></field></component>
    <component><field ref="dept"/></component>
    <component><field ref="org"/></component>
    <component><field ref="address"/></component>
    <component><field ref="country"/></component>
    <component><field ref="os"/></component>
    <component><field ref="url"/></component>

    <epc:if test="usertype = 'editor'">
      <epc:if test="$STAFF_ONLY">
        <component><field ref="editperms"/></component>
      </epc:if>
      <component><field ref="frequency" required="yes" /></component>
      <component><field ref="mailempty" required="yes" /></component>
    </epc:if>

    <epc:if test="usertype = 'admin'">
      <component><field ref="editperms" /></component>
      <component><field ref="frequency" required="yes" /></component>
      <component><field ref="mailempty" required="yes" /></component>
    </epc:if>

  </stage>
</workflow>
